# VKR_3D_Reconstruction
## Основная информация

Данный репозиторий был создан специально для ВКР на тему "Генерация анимаций боя в стиле бокатор"

Студент: Денисов Александр Ильич, группа J4221  
Научный руководитель: Карсаков Андрей Сергеевич  

Все инструкции по предварительной настройке и запуску решения продублированы в сервисе Google Collab по ссылке  
https://colab.research.google.com/drive/1EWk_yXAA2kOwJzdW6psFF9MesQ_GgjY6?usp=sharing

### **Предварительная настройка**
1. Проверить, что в меню "Среда выполнения">"Сменить среду выполнения" выбран один из графических процессоров (A100, L4 GPU, T4 GPU), это необходимо, так как работа используует графические вычисления. Выбрать нужную среду и нажать сохранить.
2. Запустить по очереди ячейки с клонированием репозитория HMMR - алгоритма, по которому происходит анализ кадров. Работа второй ячейки может занять 40 минут, так как генерируются все зависимости.
3. Скорее всего среда попросит перезапустить сеанс после установки зависимостей. Нужно нажать "Перезапустить сеанс" и после этого снова запустить вторуую ячейку клонирования. В этот раз все скомпилируется гораздо быстрее.
4. !!!Если вторая ячейка завершилась ошибкой (`mv: cannot stat 'basicModel_neutral_lbs_10_207_0_v1.0.0.pkl': No such file or directory`) значит SMPL все же ограничили доступ к своей модели через гитхаб. Нужно будет проделать дополнительные действия. Если ошибки нет, значит можно сразу переходить к пункту 8.
5. Открыть сайт https://smpl.is.tue.mpg.de/download.php, зарегестрироваться, зайти в раздел "Downloads" и нажать на ссылку `Download version 1.0.0 for Python 2.7 (female/male. 10 shape PCs)`. К сожалению, я не могу предоставить файл напрямую, так как это нарушает политику SMPL.
6. В скачанном архиве в папке "models" найти файл `basicModel_neutral_lbs_10_207_0_v1.0.0.pkl`
7. Распаковать архив и перенести файл в Collab, в директорию "`4D-Humans/data/`", открыв слева вкладку "Файл". Загрузка файла в Collab может быть долгой, нужно дождаться пока полностью отрисуется круг загрузки в нижней части вкладки файл.
8. Запустить следующие ячейки, если после четвертой появились демо кадры HMMR с фигуристками, алгоритм работает нормально и можно переходить дальше.
9. Запустить ячейку кода с клонированием основного репозитория, это также может занять до 40 минут.
10. Запустить следующую ячейку с функцией для отображения видео.

### **Запуск на своем видео**
1. Открыть панель "Файлы" слева и загрузить видеофайл в формате mp4 в директорию `example_data/videos/`.
2. Вставить в самый низ два блока кода, как в примерах выше, то есть блоки:

```
!python track.py video.source="example_data/videos/Bokator.mp4"
```

```
!ffmpeg -y -hide_banner -loglevel error -i outputs/PHALP_Bokator.mp4 outputs/PHALP_Bokator_anim.mp4
show_local_mp4_video('outputs/PHALP_Bokator_anim.mp4', width=960, height=540)
```

3. Заменить `Bokator.mp4` на название загруженного файла во всех местах в скопированных блоках.
4. Запустить блоки по очереди. В результате выполнения второго блока должно отобразится видео, полученной анимации.
5. В директории `outputs/` также появится файл с соответствующим видео названием и расширением `.pkl`, его можно использовать для импортирования анимации в редакторы.

## Результаты

Ссылка на первый пример результатов https://drive.google.com/file/d/1v08HjQZdp-yLasWkEjQp3p21Pc_SFJvi/view?usp=sharing  
Ссылка на второй пример результатов https://drive.google.com/file/d/1BVqs-RZNPuW-zkVLTz_hborfUqvrv5mX/view?usp=sharing
